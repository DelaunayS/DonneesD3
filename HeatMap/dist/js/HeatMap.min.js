const dataUrl="https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/global-temperature.json";let dataJson,baseTemperature,year,month,yScale,xScale,legendScale,values=[];const margin={top:50,right:30,bottom:10,left:70},width=1e3,height=600;let svgContainer=d3.select("#graphContainer");const drawSvgContainer=()=>{svgContainer.attr("width",1e3).attr("height",600)},propertyScales=()=>{yScale=d3.scaleTime().domain([new Date(0,0,0,0,0,0,0),new Date(0,12,0,0,0,0,0)]).range([margin.bottom,600-margin.top]),xScale=d3.scaleTime().domain([d3.min(year),d3.max(year)]).range([margin.left,1e3-margin.right])},drawBars=()=>{svgContainer.selectAll("rect").data(values).enter().append("rect").attr("class","cell").attr("fill",(t=>t.variance<-2.5?"#660099":t.variance<-1.5?"#0000ff":t.variance<-.5?"#00ffff":t.variance<.5?"#00ff00":t.variance<1.5?"#ffff00":t.variance<2.5?"#ED7F10":"#ff0000")).attr("data-month",(t=>t.month-1)).attr("data-year",(t=>t.year)).attr("data-temp",(t=>t.variance+baseTemperature)).attr("height",Math.ceil((600-margin.top-margin.bottom)/12)-1).attr("y",(t=>yScale(new Date(0,t.month-1,0,0,0,0,0)))).attr("width",(1e3-margin.left-margin.right)/(d3.max(year)-d3.min(year))).attr("x",(t=>xScale(t.year))).on("mouseover",((t,e)=>{tooltip.transition().style("opacity",.9).style("top",t.pageY-margin.top-margin.bottom+"px").style("left",t.pageX+10+"px"),tooltip.html(afficheMois(e.month-1)+" - "+e.year+"</br>Température = "+Math.round(100*(baseTemperature+e.variance))/100+"°C</br>Variation = "+e.variance+"°C"),document.querySelector("#tooltip").setAttribute("data-year",e.year)})).on("mouseout",(t=>{tooltip.transition().style("opacity",0)}))},nameAxes=()=>{svgContainer.append("text").attr("transform","rotate(-90)").attr("x",-300).attr("y",margin.right/2).style("font-size",16).text("Mois"),svgContainer.append("text").attr("x",500).attr("y",600-margin.bottom/2).style("font-size",16).text("Année")},createAxes=()=>{let t=d3.axisBottom(xScale).tickFormat(d3.format("d"));svgContainer.append("g").call(t).attr("id","x-axis").attr("transform","translate(0,"+(600-margin.top)+")");let e=d3.timeFormat("%B"),a=d3.axisLeft(yScale).tickFormat(e);svgContainer.append("g").call(a).attr("id","y-axis").attr("transform","translate("+margin.left+",0)")},createLegend=()=>{let t=d3.select("#legend");t.append("text").attr("y","15").attr("x","50").text("Variation / température de base (8,66°C) : ");const e=e=>{let a;switch(e){case 0:a="#660099";break;case 1:a="#0000ff";break;case 2:a="#00ffff";break;case 3:a="#00ff00";break;case 4:a="#ffff00";break;case 5:a="#ED7F10";break;case 6:a="#ff0000";break;default:break}t.append("rect").attr("class","legendCell").attr("fill",a).attr("width","50").attr("height","25").attr("y","25").attr("x",50*e+50)};let a=d3.scaleLinear().domain([-2.5,2.5]).range([100,350]),r=d3.axisBottom().scale(a);t.attr("width",500).attr("height",70);for(let t=0;t<7;t++)e(t);t.append("g").call(r).attr("class","legend_axis").attr("transform","translate(0,50)")};d3.json(dataUrl).then((function(t,e){if(e)throw void 0;baseTemperature=t.baseTemperature,values=t.monthlyVariance,year=values.map((t=>t.year)),svgContainer.attr("width",1e3).attr("height",600),yScale=d3.scaleTime().domain([new Date(0,0,0,0,0,0,0),new Date(0,12,0,0,0,0,0)]).range([margin.bottom,600-margin.top]),xScale=d3.scaleTime().domain([d3.min(year),d3.max(year)]).range([margin.left,1e3-margin.right]),svgContainer.selectAll("rect").data(values).enter().append("rect").attr("class","cell").attr("fill",(t=>t.variance<-2.5?"#660099":t.variance<-1.5?"#0000ff":t.variance<-.5?"#00ffff":t.variance<.5?"#00ff00":t.variance<1.5?"#ffff00":t.variance<2.5?"#ED7F10":"#ff0000")).attr("data-month",(t=>t.month-1)).attr("data-year",(t=>t.year)).attr("data-temp",(t=>t.variance+baseTemperature)).attr("height",Math.ceil((600-margin.top-margin.bottom)/12)-1).attr("y",(t=>yScale(new Date(0,t.month-1,0,0,0,0,0)))).attr("width",(1e3-margin.left-margin.right)/(d3.max(year)-d3.min(year))).attr("x",(t=>xScale(t.year))).on("mouseover",((t,e)=>{tooltip.transition().style("opacity",.9).style("top",t.pageY-margin.top-margin.bottom+"px").style("left",t.pageX+10+"px"),tooltip.html(afficheMois(e.month-1)+" - "+e.year+"</br>Température = "+Math.round(100*(baseTemperature+e.variance))/100+"°C</br>Variation = "+e.variance+"°C"),document.querySelector("#tooltip").setAttribute("data-year",e.year)})).on("mouseout",(t=>{tooltip.transition().style("opacity",0)})),svgContainer.append("text").attr("transform","rotate(-90)").attr("x",-300).attr("y",margin.right/2).style("font-size",16).text("Mois"),svgContainer.append("text").attr("x",500).attr("y",600-margin.bottom/2).style("font-size",16).text("Année"),createAxes(),createLegend()}));const tooltip=d3.select("body").append("div").attr("id","tooltip").style("opacity",0),afficheMois=t=>{switch(t){case 0:return"Janvier";break;case 1:return"Février";break;case 2:return"Mars";break;case 3:return"Avril";break;case 4:return"Mai";break;case 5:return"Juin";break;case 6:return"Juillet";break;case 7:return"Août";break;case 8:return"Septembre";break;case 9:return"Octobre";break;case 10:return"Novembre";break;case 11:return"Décembre";break;default:return"Non renseigné";break}};